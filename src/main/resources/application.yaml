spring:
  application:
    name: glenn
  main:
    allow-bean-definition-overriding: true

  # 1. Route JDBC pour Liquibase - CORRIGÉ
  datasource:
    jdbc-url: ${POSTGRES_URL:jdbc:postgresql://localhost:5432/glenn}  # Valeur par défaut correcte
    username: ${POSTGRES_USERNAME:postgres}
    password: ${POSTGRES_PWD:postgres}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 2
      minimum-idle: 1
      idle-timeout: 60000
      connection-timeout: 5000
      max-lifetime: 300000

  # 2. Route R2DBC pour ton code réactif
  r2dbc:
    url: ${POSTGRES_REACTIVE_URL:r2dbc:postgresql://localhost:5432/glenn}
    username: ${POSTGRES_USERNAME:postgres}
    password: ${POSTGRES_PWD:postgres}
    pool:
      max-size: 10
      initial-size: 5
      max-idle-time: 2m
      validation-query: SELECT 1

  # 3. Liquibase
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.yaml
    default-schema: glenn
    enabled: true
    drop-first: false
    contexts: production

  sql:
    init:
      mode: never

  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    cache: true  # ✅ Important pour la vitesse
    check-template-location: true
    reactive:
      max-chunk-size: 8192

  webflux:
    base-path: /
    format:
      date: yyyy-MM-dd
      time: HH:mm:ss

# Monitoring
monitoring:
  interval: 30000
  timeout: 5000
  history: 5000

notification:
  reminder-interval: 300000

server:
  port: 1080
  netty:
    connection-timeout: 5000
    max-initial-line-length: 4096

# Logging - Plus agressif pour réduire les logs inutiles
logging:
  level:
    root: ERROR
    org.azirar.glenn: ERROR
    org.springframework.boot: INFO
    org.springframework.web: ERROR
    org.springframework.r2dbc: ERROR
    org.springframework.jdbc: ERROR
    liquibase: ERROR
    reactor.netty: ERROR
    io.netty: ERROR